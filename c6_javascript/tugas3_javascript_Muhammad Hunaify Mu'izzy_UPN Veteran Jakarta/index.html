<!-- Tugas Pertemuan 3 JS

  - Anda diminta untuk membuat sistem manajemen pesanan untuk sebuah toko online. Sistem ini akan menangani data produk, pelanggan, dan pesanan menggunakan fungsi dan array. Setiap bagian dari sistem saling berhubungan, seperti daftar produk yang tersedia, pelanggan yang melakukan pesanan, serta proses perhitungan total pembayaran.

  - Sebuah toko memiliki daftar produk yang dijual, setiap produk memiliki informasi seperti id, nama, harga, dan stok. Toko harus bisa menambahkan produk baru, menampilkan daftar produk, dan menghapus produk yang sudah tidak dijual.

Tugas
  - Buat array produkToko yang menyimpan daftar produk dengan struktur seperti berikut:
    [
      {id: 1, nama: "Laptop", harga: 7000000, stok: 5},
      {id: 2, nama: "Mouse", harga: 200000, stok: 10},
      {id: 3, nama: "Keyboard", harga: 350000, stok: 7}
    ]

  - Buat fungsi tambahProduk(nama, harga, stok) untuk menambahkan produk baru ke dalam array.
  - Buat fungsi hapusProduk(id) untuk menghapus produk berdasarkan id.
  - Buat fungsi tampilkanProduk() untuk menampilkan daftar produk. -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />

    <style>
      body {
        --bs-body-font-family: "Montserrat", sans-serif; /* Replace 'YourDesiredFont' */
      }
    </style>

    <title>TP3 JavaScript - Muiz</title>
  </head>
  <body>
    <div class="container py-4">
      <header>
        <h2 class="h4 fw-bold text-center">Sistem Manajemen Pesanan</h2>
      </header>

      <main class="pt-4 d-flex flex-column gap-5">
        <!-- Collapsible Controller -->
        <section>
          <div class="d-inline-flex gap-3">
            <button
              class="btn btn-sm btn-success"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#tambahProdukWrapper"
              aria-expanded="false"
              aria-controls="tambahProdukWrapper"
            >
              Tambah Produk
            </button>
            <button
              class="btn btn-sm btn-outline-success"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#hapusProdukWrapper"
              aria-expanded="false"
              aria-controls="hapusProdukWrapper"
            >
              Hapus Produk
            </button>
            <button
              id="tampilkanProdukBtn"
              class="btn btn-sm btn-outline-success"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#tampilkanProdukWrapper"
              aria-expanded="false"
              aria-controls="tampilkanProdukWrapper"
            >
              Tampilkan Produk
            </button>
          </div>
        </section>

        <!-- Tambah Produk -->
        <section class="collapse show" id="tambahProdukWrapper">
          <form id="formTambahProduk" class="row row-cols-1 g-3">
            <div class="col">
              <label for="namaInput" class="form-label">Nama</label>
              <input type="text" class="form-control" id="namaInput" required />
            </div>

            <div class="col">
              <label for="hargaInput" class="form-label">Harga</label>
              <input
                type="number"
                class="form-control"
                id="hargaInput"
                required
              />
            </div>

            <div class="col">
              <label for="stokInput" class="form-label">Stok</label>
              <input
                type="number"
                class="form-control"
                id="stokInput"
                required
              />
            </div>

            <div class="col mt-5">
              <button
                id="submitBtnTambahProduk"
                type="submit"
                class="btn btn-primary w-100"
                data-submit-for="formTambahProduk"
              >
                Tambah Produk
              </button>
            </div>
          </form>
        </section>

        <!-- Hapus Produk -->
        <section class="collapse" id="hapusProdukWrapper">
          <form id="formHapusProduk" class="row row-cols-1 g-3">
            <div class="col">
              <label for="idInput" class="form-label">ID</label>
              <input
                type="number"
                min="1"
                class="form-control"
                id="idInput"
                required
              />
            </div>

            <div class="col mt-5">
              <button
                id="submitBtnHapusProduk"
                type="submit"
                class="btn btn-primary w-100"
                data-submit-for="formHapusProduk"
              >
                Hapus Produk
              </button>
            </div>
          </form>
        </section>

        <!-- Tampilkan Produk -->
        <section class="collapse" id="tampilkanProdukWrapper">
          <pre id="tampilkanProdukPre"></pre>
        </section>
      </main>
    </div>

    <!-- Bootstrap JavaScript -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>

    <!-- Project JavaScript -->
    <script>
      // HTMLElements DOM
      const namaInput = document.getElementById("namaInput");
      const hargaInput = document.getElementById("hargaInput");
      const stokInput = document.getElementById("stokInput");
      const idInput = document.getElementById("idInput");
      const tampilkanProdukBtn = document.getElementById("tampilkanProdukBtn");
      const tampilkanProdukPre = document.getElementById("tampilkanProdukPre");

      // Data Awal produk toko
      let produkToko = [
        {
          id: 1,
          nama: "Laptop",
          harga: 7_000_000,
          stok: 5,
        },
        {
          id: 2,
          nama: "Mouse",
          harga: 200_000,
          stok: 10,
        },
        {
          id: 3,
          nama: "Keyboard",
          harga: 350_000,
          stok: 7,
        },
      ];

      // Berguna untuk autoIncrement id dari produk baru
      let lastIdProduk = 3;

      // Ubah value input element jadi Integer
      function stringValueToInt(value) {
        return Number.parseInt(value);
      }

      // +-------------------------------+
      // |     Tambah Produk Section     |
      // +-------------------------------+

      function tambahProduk(nama, harga, stok) {
        let errorMsg = "";
        if (typeof nama !== "string") {
          errorMsg = "nama harus berupa string!";
        } else if (typeof harga !== "number") {
          errorMsg = "harga harus berupa angka";
        } else if (typeof stok !== "number") {
          errorMsg = "stok harus berupa angka";
        }

        for (const produk of produkToko) {
          if (produk.nama === nama) {
            errorMsg = "produk dengan nama tersebut sudah ada!";
          }
        }

        if (errorMsg) {
          alert(errorMsg);
          return;
        }

        const newProduct = {
          id: ++lastIdProduk,
          nama,
          harga,
          stok,
        };

        // Tambahkan ke array daftar produk
        produkToko.push(newProduct);
        tampilkanProduk();
      }

      // +------------------------------+
      // |     Hapus Produk Section     |
      // +------------------------------+

      function hapusProduk(id) {
        let index = -1;
        for (let i = 0; i < produkToko.length; i++) {
          const produk = produkToko[i];

          if (produk.id === id) {
            index = i;
            break;
          }
        }

        if (index === -1) {
          alert(`Produk dengan id ${id} tidak ditemukan!`);
          return;
        }

        produkToko.splice(index, 1);
        tampilkanProduk();
      }

      // +----------------------------------+
      // |     Tampilkan Produk Section     |
      // +----------------------------------+

      tampilkanProdukBtn.addEventListener("click", () => {
        tampilkanProduk();
      });

      function tampilkanProduk() {
        const formattedString = JSON.stringify(produkToko, null, 2);
        tampilkanProdukPre.innerHTML = formattedString;
      }

      function updateSubmitBtn(formId) {
        const form = document.getElementById(formId);
        const submitBtn = document.querySelector(
          `button[type="submit"][data-submit-for="${formId}"]`
        );

        // Check if the form is valid
        if (form.checkValidity()) {
          submitBtn.removeAttribute("disabled"); // Enable the button
        } else {
          submitBtn.setAttribute("disabled", "true"); // Disable the button
        }
      }

      // +----------------------------------+
      // |     Forms Controller Section     |
      // +----------------------------------+

      const forms = document.querySelectorAll("form");
      for (const form of forms) {
        const { id } = form;

        form.addEventListener("input", () => {
          updateSubmitBtn(id);
        });

        form.addEventListener("submit", (e) => {
          e.preventDefault();

          if (id === "formTambahProduk") {
            tambahProduk(
              namaInput.value,
              stringValueToInt(hargaInput.value),
              stringValueToInt(stokInput.value)
            );
          } else if (id === "formHapusProduk") {
            hapusProduk(stringValueToInt(idInput.value));
          }

          form.reset();
          updateSubmitBtn(id);
        });

        updateSubmitBtn(id);
      }

      const collapseWrappers = document.querySelectorAll(".collapse");
      for (const wrapper of collapseWrappers) {
        const trigger = document.querySelector(
          `[data-bs-toggle="collapse"][data-bs-target="#${wrapper.id}"]`
        );

        wrapper.addEventListener("show.bs.collapse", () => {
          trigger.classList.remove("btn-outline-success");
          trigger.classList.add("btn-success");
        });

        wrapper.addEventListener("hide.bs.collapse", () => {
          trigger.classList.remove("btn-success");
          trigger.classList.add("btn-outline-success");
        });
      }
    </script>
  </body>
</html>
